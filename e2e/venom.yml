name: APIIntegrationTest

vars:
  url: http://tigerhall-service-e2e:8081/api

testcases:
  - name: Login
    steps:
      - type: http
        method: POST
        url: {{.url}}/login
        body: |
          {"email": "superuser@tigerhall.com", "password": "password"}
        vars:
          token:
            from: result.bodyjson.payload.token
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson.success ShouldEqual true
          - result.bodyjson.payload ShouldContainKey token

  - name: CreateUser http testcase
    steps:
      - type: http
        method: POST
        headers:
          Authorization: "{{.Login.token}}"
        url: {{.url}}/user
        body: |
          {"username": "User2", "email": "user2@tigerhall.com", "password": "password"}
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson ShouldContainKey success
